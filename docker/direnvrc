function use_pip-tools() {
    requirements_file=${1:?"a requirements file must be provided as the first argument"}
    shift
    local has_pip=0
    if has pip; then
        if [[ $(which pip) = $PWD/* ]]; then
            has_pip=1
        fi
    fi
    if [ $has_pip -eq 0 ]; then
        echo "[use pip-tools] No pip installed via layout; try layout pyenv or layout python"
        return 1
    fi

    if ! test -f $requirements_file; then
        echo "[use pip-tools] No requirements file $requirements_file"
        return 1
    fi

    if ! has pip-compile; then
        echo "[use pip-tools] pip-tools missing; installing"
        pip install pip-tools
    fi

    deps=$(python docker/direnvrc_helpers.py $requirements_file)
    ret_val=$?

    requirements_txt=$(echo "$requirements_file" | cut -f 1 -d '.').txt
    if [ $ret_val -eq 1 ]; then
        echo "[use pip-tools] resyncing main requirements ($requirements_file)"
        pip-compile "$@" $requirements_file -o $requirements_txt
        echo "[use pip-tools] resyncing dependencies ($deps)"
	for other_requirements_file in $(grep -v $requirements_file <<< $(tr ' ' '\n' <<< $deps)); do
            echo "[use pip-tools] resyncing dependency ($other_requirements_file)"
            other_requirements_txt=$(echo "$other_requirements_file" | cut -f 1 -d '.').txt
            pip-compile "$@" $other_requirements_file -o $other_requirements_txt
        done
    fi
    pip-sync $requirements_txt

    echo "[use pip-tools] monitoring $deps"
    watch_file $deps
}
